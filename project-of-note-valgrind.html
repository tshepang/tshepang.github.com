<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Tshepang Lekhonkhobe" />
        <meta name="copyright" content="Tshepang Lekhonkhobe" />

        <meta name="twitter:creator" content="@tshepang_dev">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="'project-of-note, non-Python', computing, " />

<meta property="og:title" content="&#39;project of note: Valgrind&#39; "/>
<meta property="og:url" content="http://tshepang.net/project-of-note-valgrind" />
<meta property="og:description" content="I have, since using Valgrind (and reading a bit of its documentation) some years ago, developed much respect for it. It is quite an advanced tool, and though its primary use is detecting memory leaks, I am here going to explore its other functionality... calculating the cost of each line …" />
<meta property="og:site_name" content="Tshepang logs" />
<meta property="og:article:author" content="Tshepang Lekhonkhobe" />
<meta property="og:article:published_time" content="2013-09-25T00:00:00+02:00" />
<meta name="twitter:title" content="&#39;project of note: Valgrind&#39; ">
<meta name="twitter:description" content="I have, since using Valgrind (and reading a bit of its documentation) some years ago, developed much respect for it. It is quite an advanced tool, and though its primary use is detecting memory leaks, I am here going to explore its other functionality... calculating the cost of each line …">

        <title>&#39;project of note: Valgrind&#39;  · Tshepang logs
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://tshepang.net/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://tshepang.net/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://tshepang.net/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://tshepang.net/theme/css/custom.css" media="screen">
        <link href="http://tshepang.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tshepang logs - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-16685250-3', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://tshepang.net/"><span class=site-name>Tshepang logs</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://tshepang.net">Home</a></li>
                            <li ><a href="http://tshepang.net/about-me.html">about me</a></li>
                            <li ><a href="http://tshepang.net/categories.html">Categories</a></li>
                            <li ><a href="http://tshepang.net/tags.html">Tags</a></li>
                            <li ><a href="http://tshepang.net/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://tshepang.net/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://tshepang.net/project-of-note-valgrind"> 'project of note: Valgrind'  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <p>I have, since using Valgrind (and reading a bit of its documentation)
some years ago, developed much respect for it. It is quite an advanced
tool, and though its primary use is detecting memory leaks, I am here
going to explore its other functionality... calculating the cost of
each line of code in the CPU. This is useful when tuning programs for
performance.</p>
<p>Following is example code; it accepts 2 arguments, a filename and text
that will be written to that file:</p>
<p>``` {.sourceCode .c}</p>
<h1>include <string.h></h1>
<h1>include <errno.h></h1>
<h1>include <stdio.h></h1>
<h1>include <fcntl.h></h1>
<h1>include <unistd.h></h1>
<p>int
main (int argc, char **argv)
{
    char path[0xFF];
    char content[0xFF];
    int fd;
    ssize_t written;</p>
<div class="highlight"><pre><span></span><span class="nt">if</span> <span class="o">(</span><span class="nt">argc</span> <span class="o">&lt;</span> <span class="nt">3</span><span class="o">)</span> <span class="p">{</span>
    <span class="err">fprintf</span> <span class="err">(stderr,</span> <span class="err">&quot;</span><span class="n">usage</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="k">content</span><span class="o">&gt;</span><span class="err">\</span><span class="n">n</span><span class="s2">&quot;, argv</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="s2">);</span>
<span class="s2">    return 1;</span>
<span class="s2">}</span>

<span class="s2">strcpy (path, argv</span><span class="cp">[</span><span class="mi">1</span><span class="cp">]</span><span class="s2">);</span>
<span class="s2">sprintf (content, &quot;</span><span class="o">%</span><span class="n">s</span><span class="err">\</span><span class="n">n</span><span class="s2">&quot;, argv</span><span class="cp">[</span><span class="mi">2</span><span class="cp">]</span><span class="s2">);</span>

<span class="s2">fd = creat (path, S_IRWXU);</span>
<span class="s2">if (fd == -1) {</span>
<span class="s2">    fprintf (stderr, &quot;</span><span class="kc">open</span> <span class="n">error</span><span class="o">:</span> <span class="o">%</span><span class="n">s</span> <span class="p">(</span><span class="s1">&#39;%s&#39;</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="s2">&quot;, strerror (errno), path);</span>
<span class="s2">    return 1;</span>
<span class="s2">}</span>

<span class="s2">written = write (fd, content, strlen (content));</span>
<span class="s2">if (written == -1) {</span>
<span class="s2">    fprintf (stderr, &quot;</span><span class="n">write</span> <span class="n">error</span><span class="o">:</span> <span class="o">%</span><span class="n">s</span> <span class="p">(</span><span class="s1">&#39;%s&#39;</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="err">&quot;</span><span class="p">,</span> <span class="n">strerror</span> <span class="p">(</span><span class="n">errno</span><span class="p">),</span> <span class="n">path</span><span class="p">);</span>
    <span class="err">return</span> <span class="err">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">return</span> <span class="nt">0</span><span class="o">;</span>
</pre></div>


<p>}
```</p>
<p>Build command (using GCC 4.8.1):</p>
<div class="highlight"><pre><span></span>gcc -Wall -pedantic -g play.c -o play
</pre></div>


<p>System details:</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">uname</span> <span class="o">--</span><span class="n">all</span>
<span class="n">Linux</span> <span class="n">thome</span> <span class="mf">3.11</span><span class="o">-</span><span class="n">trunk</span><span class="o">-</span><span class="n">amd64</span> <span class="err">#</span><span class="mi">1</span> <span class="n">SMP</span> <span class="n">Debian</span> <span class="mf">3.11</span><span class="o">-</span><span class="mi">1</span><span class="o">~</span><span class="n">exp1</span> <span class="p">(</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span> <span class="n">x86_64</span> <span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">lshw</span> <span class="o">-</span><span class="k">class</span> <span class="n">processor</span>
<span class="o">*-</span><span class="n">cpu</span>
     <span class="nl">description</span><span class="p">:</span> <span class="n">CPU</span>
     <span class="nl">product</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i5</span><span class="o">-</span><span class="mi">2410</span><span class="n">M</span> <span class="n">CPU</span> <span class="p">@</span> <span class="mf">2.30</span><span class="n">GHz</span>
     <span class="nl">vendor</span><span class="p">:</span> <span class="n">Intel</span> <span class="n">Corp</span><span class="p">.</span>
     <span class="n">physical</span> <span class="kt">id</span><span class="o">:</span> <span class="mi">4</span>
     <span class="n">bus</span> <span class="nl">info</span><span class="p">:</span> <span class="n">cpu</span><span class="mi">@0</span>
     <span class="nl">version</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i5</span><span class="o">-</span><span class="mi">2410</span><span class="n">M</span> <span class="n">CPU</span> <span class="p">@</span> <span class="mf">2.30</span><span class="n">GHz</span>
     <span class="nl">serial</span><span class="p">:</span> <span class="n">To</span> <span class="n">Be</span> <span class="n">Filled</span> <span class="n">By</span> <span class="n">O</span><span class="p">.</span><span class="n">E</span><span class="p">.</span><span class="n">M</span><span class="p">.</span>
     <span class="nl">slot</span><span class="p">:</span> <span class="n">CPU</span> <span class="mi">1</span>
     <span class="nl">size</span><span class="p">:</span> <span class="mi">2300</span><span class="n">MHz</span>
     <span class="nl">capacity</span><span class="p">:</span> <span class="mi">4</span><span class="n">GHz</span>
     <span class="nl">width</span><span class="p">:</span> <span class="mi">64</span> <span class="n">bits</span>
     <span class="nl">clock</span><span class="p">:</span> <span class="mi">100</span><span class="n">MHz</span>
     <span class="nl">capabilities</span><span class="p">:</span> <span class="n">x86</span><span class="o">-</span><span class="mi">64</span> <span class="n">fpu</span> <span class="n">fpu_exception</span> <span class="n">wp</span> <span class="n">vme</span> <span class="n">de</span> <span class="n">pse</span> <span class="n">tsc</span> <span class="n">msr</span>
     <span class="n">pae</span> <span class="n">mce</span> <span class="n">cx8</span> <span class="n">apic</span> <span class="n">sep</span> <span class="n">mtrr</span> <span class="n">pge</span> <span class="n">mca</span> <span class="n">cmov</span> <span class="n">pat</span> <span class="n">pse36</span> <span class="n">clflush</span> <span class="n">dts</span>
     <span class="n">acpi</span> <span class="n">mmx</span> <span class="n">fxsr</span> <span class="n">sse</span> <span class="n">sse2</span> <span class="n">ss</span> <span class="n">ht</span> <span class="n">tm</span> <span class="n">pbe</span> <span class="n">syscall</span> <span class="n">nx</span> <span class="n">rdtscp</span>
     <span class="n">constant_tsc</span> <span class="n">arch_perfmon</span> <span class="n">pebs</span> <span class="n">bts</span> <span class="n">rep_good</span> <span class="n">nopl</span> <span class="n">xtopology</span>
     <span class="n">nonstop_tsc</span> <span class="n">aperfmperf</span> <span class="n">eagerfpu</span> <span class="n">pni</span> <span class="n">pclmulqdq</span> <span class="n">dtes64</span> <span class="n">monitor</span>
     <span class="n">ds_cpl</span> <span class="n">vmx</span> <span class="n">est</span> <span class="n">tm2</span> <span class="n">ssse3</span> <span class="n">cx16</span> <span class="n">xtpr</span> <span class="n">pdcm</span> <span class="n">pcid</span> <span class="n">sse4_1</span> <span class="n">sse4_2</span>
     <span class="n">x2apic</span> <span class="n">popcnt</span> <span class="n">tsc_deadline_timer</span> <span class="n">xsave</span> <span class="n">avx</span> <span class="n">lahf_lm</span> <span class="n">ida</span> <span class="n">arat</span> <span class="n">epb</span>
     <span class="n">xsaveopt</span> <span class="n">pln</span> <span class="n">pts</span> <span class="n">dtherm</span> <span class="n">tpr_shadow</span> <span class="n">vnmi</span> <span class="n">flexpriority</span> <span class="n">ept</span> <span class="n">vpid</span>
     <span class="n">aes</span> <span class="n">cpufreq</span>
     <span class="nl">configuration</span><span class="p">:</span> <span class="n">cores</span><span class="o">=</span><span class="mi">2</span> <span class="n">enabledcores</span><span class="o">=</span><span class="mi">1</span> <span class="n">threads</span><span class="o">=</span><span class="mi">2</span>
</pre></div>


<p>Running the resulting binary with <strong>Callgrind</strong>:</p>
<div class="highlight"><pre><span></span>$ valgrind --tool<span class="o">=</span>callgrind --callgrind-out-file<span class="o">=</span>out ./play filename
<span class="nv">filecontent</span>
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> Callgrind, a call-graph generating cache <span class="nv">profiler</span>
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2002</span>-2012, and GNU GPL<span class="s1">&#39;d, by Josef Weidendorfer</span>
<span class="s1">et al.</span>
<span class="s1">==5308== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright</span>
<span class="s1">info</span>
<span class="s1">==5308== Command: ./play filename filecontent</span>
<span class="s1">==5308== </span>
<span class="s1">==5308== For interactive control, run &#39;</span>callgrind_control -h<span class="err">&#39;</span>.
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> 
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> Events    : <span class="nv">Ir</span>
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> Collected : <span class="nv">107520</span>
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> 
<span class="o">==</span><span class="nv">5308</span><span class="o">==</span> I   refs:      <span class="m">107</span>,520
$ cat filename 
filecontent
</pre></div>


<p>And finally, seeing closely the cost of each function call, where <strong>Ir</strong>
stands for <strong>Instruction cache reads</strong>, which you can read as <em>number of
CPU instructions</em>. I have used <code>tree=calling</code> option so that I can see
the cost of all operations called by a parent (marked with a <code>*</code>) :</p>
<div class="highlight"><pre><span></span>$ callgrind_annotate --tree<span class="o">=</span>calling out play.c
--------------------------------------------------------------------------------
Profile data file <span class="s1">&#39;out&#39;</span> <span class="o">(</span>creator: callgrind-3.8.1<span class="o">)</span>
--------------------------------------------------------------------------------
I1 cache: 
D1 cache: 
LL cache: 
Timerange: Basic block <span class="m">0</span> - <span class="m">22326</span>
Trigger: Program termination
Profiled target:  ./play filename filecontent <span class="o">(</span>PID <span class="m">5308</span>, part <span class="m">1</span><span class="o">)</span>
Events recorded:  Ir
Events shown:     Ir
Event sort order: Ir
Thresholds:       <span class="m">99</span>
Include dirs:     
User annotated:   play.c
Auto-annotation:  off

--------------------------------------------------------------------------------
Ir 
--------------------------------------------------------------------------------
<span class="m">107</span>,520  PROGRAM TOTALS

--------------------------------------------------------------------------------
Ir  file:function
--------------------------------------------------------------------------------

<span class="m">24</span>,113  *  /build/eglibc-TepTGA/eglibc-2.17/elf/dl-lookup.c:do_lookup_x <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>
<span class="m">1</span>,053  &gt;   /build/eglibc-TepTGA/eglibc-2.17/elf/dl-misc.c:_dl_name_match_p <span class="o">(</span>25x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>
<span class="m">13</span>,423  &gt;   /build/eglibc-TepTGA/eglibc-2.17/elf/dl-lookup.c:check_match.9345 <span class="o">(</span>88x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>

<span class="m">18</span>,264  *  /build/eglibc-TepTGA/eglibc-2.17/elf/dl-lookup.c:_dl_lookup_symbol_x <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>
<span class="m">38</span>,589  &gt;   /build/eglibc-TepTGA/eglibc-2.17/elf/dl-lookup.c:do_lookup_x <span class="o">(</span>94x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>

<span class="m">15</span>,836  *  /build/eglibc-TepTGA/eglibc-2.17/elf/../sysdeps/x86_64/dl-machine.h:_dl_relocate_object
<span class="m">13</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/memmove.c:memcpy@GLIBC_2.2.5 <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="m">81</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/strcmp.S:strcasecmp <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="m">6</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/strcmp.S:strncasecmp <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="m">7</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/memset.S:memset <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="m">51</span>,501  &gt;   /build/eglibc-TepTGA/eglibc-2.17/elf/dl-lookup.c:_dl_lookup_symbol_x <span class="o">(</span>86x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>
<span class="m">18</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/../memcpy.S:memcpy <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/ld-2.17.so<span class="o">]</span>
<span class="m">67</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/time/../sysdeps/unix/sysv/linux/x86_64/time.c:time <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="m">67</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/time/../sysdeps/unix/sysv/linux/x86_64/gettimeofday.c:gettimeofday <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="m">6</span>  &gt;   /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/strnlen.S:strnlen <span class="o">(</span>1x<span class="o">)</span> <span class="o">[</span>/lib/x86_64-linux-gnu/libc-2.17.so<span class="o">]</span>
<span class="o">[</span>snip<span class="p">;</span> to be continued<span class="o">]</span>
</pre></div>


<p>I have trimmed the output to bring focus to the most interesting output
of all, which is the total cost for each line of my code:</p>
<div class="highlight"><pre><span></span><span class="k">[continued]</span>
<span class="na">--------------------------------------------------------------------------------</span>
<span class="na">-- User-annotated source: play.c</span>
<span class="na">--------------------------------------------------------------------------------</span>
<span class="na">Ir</span>

<span class="na">.  #include &lt;string.h&gt;</span>
<span class="na">.  #include &lt;errno.h&gt;</span>
<span class="na">.  #include &lt;stdio.h&gt;</span>
<span class="na">.  #include &lt;fcntl.h&gt;</span>
<span class="na">.  #include &lt;unistd.h&gt;</span>
<span class="na">.  </span>
<span class="na">.  int</span>
<span class="na">.  main (int argc, char **argv)</span>
<span class="na">5  {</span>
<span class="na">.      char path[0xFF];</span>
<span class="na">.      char content[0xFF];</span>
<span class="na">.      int fd;</span>
<span class="na">.      ssize_t written;</span>
<span class="na">.  </span>
<span class="na">2      if (argc &lt; 3) {</span>
<span class="na">.     fprintf (stderr, &quot;usage: %s &lt;filename&gt; &lt;content&gt;\n&quot;, argv[0]);</span>
<span class="na">.     return 1;</span>
<span class="na">.      }</span>
<span class="na">.  </span>
<span class="na">7      strcpy (path, argv[1]);</span>
<span class="na">21</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/strcpy-sse2-unaligned.S:__strcpy_sse2_unaligned (1x)</span>
<span class="na">799</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/elf/../sysdeps/x86_64/dl-trampoline.S:_dl_runtime_resolve (1x)</span>
<span class="na">8      sprintf (content, &quot;%s\n&quot;, argv[2]);</span>
<span class="na">1,188</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/stdio-common/sprintf.c:sprintf (1x)</span>
<span class="na">805</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/elf/../sysdeps/x86_64/dl-trampoline.S:_dl_runtime_resolve (1x)</span>
<span class="na">.  </span>
<span class="na">5      fd</span> <span class="o">=</span> <span class="s">creat (path, S_IRWXU);</span>
<span class="na">766</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/elf/../sysdeps/x86_64/dl-trampoline.S:_dl_runtime_resolve (1x)</span>
<span class="na">7</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/io/../sysdeps/unix/syscall-template.S:creat (1x)</span>
<span class="na">2      if (fd</span> <span class="o">=</span><span class="s">= -1) {</span>
<span class="na">.     fprintf (stderr, &quot;open error: %s (&#39;%s&#39;)\n&quot;, strerror (errno), path);</span>
<span class="na">.     return 1;</span>
<span class="na">.      }</span>
<span class="na">.  </span>
<span class="na">10      written</span> <span class="o">=</span> <span class="s">write (fd, content, strlen (content));</span>
<span class="na">7</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/io/../sysdeps/unix/syscall-template.S:write (1x)</span>
<span class="na">14</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/string/../sysdeps/x86_64/multiarch/strlen-sse2-pminub.S:__strlen_sse2_pminub (1x)</span>
<span class="na">1,567</span>  <span class="o">=</span><span class="s">&gt; /build/eglibc-TepTGA/eglibc-2.17/elf/../sysdeps/x86_64/dl-trampoline.S:_dl_runtime_resolve (2x)</span>
<span class="na">2      if (written</span> <span class="o">=</span><span class="s">= -1) {</span>
<span class="na">.     fprintf (stderr, &quot;write error: %s (&#39;%s&#39;)\n&quot;, strerror (errno), path);</span>
<span class="na">.     return 1;</span>
<span class="na">.      }</span>
<span class="na">1      return 0;</span>
<span class="na">2  }</span>

<span class="na">--------------------------------------------------------------------------------</span>
<span class="na">Ir </span>
<span class="na">--------------------------------------------------------------------------------</span>
<span class="na">0  percentage of events annotated</span>
</pre></div>


<p>As an aside, note that the indentation is messed up a bit.</p>
<p>---</p>
<p>Since I normally work at too high a level to care about CPU instructions
cycles at this detail, I found the exercise eye-opening.</p>
            
            <section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://tshepang.net/project-of-note-valgrind#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'tshepanglogs';
        var disqus_identifier = 'http://tshepang.net/project-of-note-valgrind';
    var disqus_url = 'http://tshepang.net/project-of-note-valgrind';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://tshepang.net/person-of-interest-season-2-episode-16" title="Previous: &#39;Person of Interest - Season 2 Episode 16&#39;">'Person of Interest - Season 2 Episode 16'</a></li>
                <li class="next-article"><a href="http://tshepang.net/favorite-pelican-themes" title="Next: favorite Pelican themes">favorite Pelican themes</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2013-09-25T00:00:00+02:00">Sep 25, 2013</time>
            <h4>Category</h4>
            <a class="category-link" href="http://tshepang.net/categories.html#computing-ref">computing</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://tshepang.net/tags.html#non-python-ref">non-Python'
                    <span>17</span>
</a></li>
                <li><a href="http://tshepang.net/tags.html#project-of-note-ref">'project-of-note
                    <span>18</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
    <a href="https://bitbucket.org/tshepang" title="My bitbucket Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-bitbucket sidebar-social-links"></i></a>
    <a href="https://github.com/tshepang" title="My github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="https://twitter.com/tshepang_dev" title="My twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license"><a rel="license"
href="http://creativecommons.org/licenses/by-sa/3.0/"><img
alt="Creative Commons License" style="border-width:0"
src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a><br
/>This work is licensed under a <a rel="license"
href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
Attribution-ShareAlike 3.0 Unported License</a>.</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'tshepanglogs';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>